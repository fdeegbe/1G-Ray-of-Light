#!/bin/bash

# This script will run a monitoring check and print results in the /Monitoring directory.

# Using Colors for readability
RED='\033[0;31m'
LB='\033[1;34m'
CYAN='\033[1;36m'
NC='\033[0m'

sudo mkdir /Monitoring &> /dev/null
sudo touch /Monitoring/test &> /dev/null

echo -e -n "${CYAN}Hostname:${NC} " >> /Monitoring/test
sudo hostname >> /Monitoring/test

echo -e -n "${CYAN}LSB_Release:${NC} " >> /Monitoring/test
sudo lsb_release -s -d >> /Monitoring/test

echo -e "${CYAN}Current Kernel Information:${NC}" >> /Monitoring/test
sudo uname -o >> /Monitoring/test
sudo uname -r >> /Monitoring/test
sudo uname -m >> /Monitoring/test

load_val=$(cut -d " " -f 3 /proc/loadavg)
# load_val2=$(cut -d " " -f 2 /proc/loadavg)
# load_val3=$(cut -d " " -f 3 /proc/loadavg)
# avg_load=$((${load_val1} + ${load_val2} + ${load_val3}) / 3)

echo -e -n "${CYAN}Average Load (CPU/IO) Past 10min:${NC} " >> /Monitoring/test
sudo echo "${load_val}" >> /Monitoring/test

# num_processes=$(cut -d " " -f 4 /proc/loadavg)
echo -e -n "${CYAN}Number of Processes:${NC} " >> /Monitoring/test
sudo ps aux --no-headers | wc -l" >> /Monitoring/test

echo -e -n "${CYAN}Uptime:${NC} " >> /Monitoring/test
uptime -p >> /Monitoring/test

echo -e "${CYAN}Logged in Users:${NC}" >> /Monitoring/test
who >> /Monitoring/test

echo -e "${CYAN}Memory Usage in Mebibytes:${NC}" >> /Monitoring/test
free -m >> /Monitoring/test

echo -e "${CYAN}Disk Usage:${NC}" >> /Monitoring/test
df -H >> /Monitoring/test

echo -e "${CYAN}Running Containers:${NC}" >> /Monitoring/test
sudo lxc-ls -f --running >> /Monitoring/test


echo -e "${CYAN}Top 5 Processes by CPU Usage:${NC}" >> /Monitoring/test
sudo ps aux --sort -%cpu | head -5 >> /Monitoring/test

echo -e "${CYAN}Top 5 Processes by Memory Usage:${NC}" >> /Monitoring/test
sudo ps aux --sort -%mem | head -5 >> /Monitoring/test
