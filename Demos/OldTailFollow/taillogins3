#!/bin/bash

# process_new_line() {
#     # local var=''
#     while IFS= read -r line3
#     do
#         attacker_ip=$(echo "$line3" | cut -d ";" -f 2)
#         # Need to add iptables rule
#         if [ -n "$attacker_ip" ]; then
#         echo $attacker_ip >> /LoginIPs
#             sudo /sbin/iptables --insert INPUT --protocol tcp ! --source $attacker_ip --dport 5003 --jump DROP -m comment --comment "Drop other attackers container3"
#         fi
#         read
#     done
# }

# # tail -n 0 -f /MITM/logs/logins/container3.log | process_new_line
# inotifywait --monitor --event modify /MITM/logs/logins/container3.log | process_new_line

process_new_line() {
    # local var=''
    while IFS= read -r path event; do
        line1=$(tail -n 1 /MITM/logs/logins/container3.log)
        attacker_ip=$(echo "$line1" | cut -d ";" -f 2)
        # Need to add iptables rule
        if [ -n "$attacker_ip" ]; then
        echo $attacker_ip >> /LoginIPs
            sudo /sbin/iptables --insert INPUT --protocol tcp ! --source $attacker_ip --dport 5003 --jump DROP -m comment --comment "Drop other attackers container3"
        fi
        read
    done
}

inotifywait --monitor --event modify /MITM/logs/logins/container3.log | process_new_line